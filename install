#!/usr/bin/env bash

#
# Exit at any error
#
set -e

#
# Find base dir and go there
#
DIR="$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")"
cd "${DIR}"

#
# Load library for printing info
#
. ./print

#
# Install some required software
#
info "Install wget, curl and xclip"
export LC_ALL=en_US.UTF-8
sudo apt-get install wget curl xclip -yq > /dev/null
ok

#
# Manage directories
#
if [ ! -d ~/Code ]; then
	info "Creating ~/Code directory"
	mkdir ~/Code
	ok
fi

if [ -d ~/Templates ]; then
	info "Deleting ~/Templates directory"
	mkdir ~/Templates
	ok
fi

if [ -d ~/Examples ]; then
	info "Deleting ~/Examples directory"
	mkdir ~/Examples
	ok
fi

#
# Load bash_profile
#
if ! cat ~/.bashrc | grep -q '. ~/.bash_profile'; then
	info "Loading .bash_profile by .bashrc"
	echo -e '\n. ~/.bash_profile' >> ~/.bashrc
	ok 1
	warn "Restart terminal"
fi

#
# Create symbolic links for all conf files
#
for FILEPATH in $(find conf -type f -not -path "."); do
	NAME=$(basename "${FILEPATH}")
	if [ -h ~/.${NAME} ]; then
		rm ~/.${NAME}
	fi

	if [ -f ~/.${NAME} ]; then
		warn "Skipping ~/.${NAME}. File already exists"
	else
		info "Creating symlink ~/.${NAME}"
		ln -s ${DIR}/${FILEPATH} ~/.${NAME}
		ok
	fi
done
unset FILEPATH

#
# Run all app installs
#
for APP in $DIR/app/*; do
	sudo bash $APP
done
unset APP

echo
ok
echo